(function(a){"use strict";function b(a){var b=";base64,";if(-1==a.indexOf(b)){var c=a.split(","),d=c[0].split(":")[1],e=decodeURIComponent(c[1]);return new Blob([e],{type:d})}for(var c=a.split(b),d=c[0].split(":")[1],e=window.atob(c[1]),f=e.length,g=new Uint8Array(f),h=0;f>h;++h)g[h]=e.charCodeAt(h);return new Blob([g],{type:d})}function c(a,c,d){if(d=d||"graph."+c,navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(b(a),d);else if(navigator.msSaveBlob)navigator.msSaveBlob(b(a),d);else{var e=document.createElement("a");e.setAttribute("href",a),e.setAttribute("download",d),document.body.appendChild(e),e.click(),document.body.removeChild(e)}}function d(a,b,c){var d=Math.min(c/a,c/b);return{width:a*d,height:b*d}}function e(a,b,c){var d;return d=sigma.utils.getBoundaries(a.graph,b.camera.readPrefix),d.minX/=c.zoomRatio,d.minY/=c.zoomRatio,d.maxX/=c.zoomRatio,d.maxY/=c.zoomRatio,d}function f(a,b,c){var f,g=c.margin||0,h={width:b.width,height:b.height};return c.clips||c.size?c.size&&c.size>=1&&(h=d(b.width,b.height,c.size)):(f=e(a,b,c),h={width:f.maxX-f.minX+2*f.sizeMax,height:f.maxY-f.minY+2*f.sizeMax}),h.width+=g,h.height+=g,h}function g(a,b,d){if(d=d||{},d.format&&!(d.format in i))throw Error('sigma.renderers.image: unsupported format "'+d.format+'".');var e=f(a,b,d),g=a.settings("batchEdgesDrawing");g&&a.settings("batchEdgesDrawing",!1),d.clip||this.clone(a,d,e);var h=this.draw(b,d,e);a.settings("batchEdgesDrawing",g);var j=h.toDataURL(i[d.format||"png"]);return d.download&&c(j,d.format||"png",d.filename),j}if("undefined"==typeof sigma)throw"sigma is not declared";sigma.utils.pkg("sigma.plugins");var h,i,j,k;h=["scene","edges","nodes","labels"],i={png:"image/png",jpg:"image/jpeg",gif:"image/gif",tiff:"image/tiff"},g.prototype.clone=function(a,b,c){b.tmpContainer=b.tmpContainer||"image-container";var d=sigma.utils.getPixelRatio(),e=a.settings("webglOversamplingRatio"),f=document.getElementById(b.tmpContainer);f||(f=document.createElement("div"),f.id=b.tmpContainer,document.body.appendChild(f)),f.setAttribute("style","width:"+Math.round(c.width/d)+"px;height:"+Math.round(c.height/d)+"px;");var g=a.addRenderer({container:document.getElementById(b.tmpContainer),type:"canvas",settings:{batchEdgesDrawing:!0,drawLabels:!!b.labels}});g.camera.ratio=b.zoomRatio>0?b.zoomRatio:1,b.size||(g.camera.ratio*=d);var i=g instanceof sigma.renderers.webgl,l=!1,m=[];j=document.createElement("canvas"),k=j.getContext("2d"),a.refresh(),h.forEach(function(a){if(g.contexts[a]&&(b.labels!==!1||"labels"!==a)){var d=g.domElements[a]||g.domElements.scene,f=g.contexts[a];l||(j.width=c.width,j.height=c.height,i&&f instanceof WebGLRenderingContext&&(j.width/=e,j.height/=e),l=!0),f instanceof WebGLRenderingContext?k.drawImage(d,0,0,d.width/e,d.height/e):k.drawImage(d,0,0),~m.indexOf(f)||m.push(f)}}),m=[],a.killRenderer(g),f.parentNode.removeChild(f)},g.prototype.draw=function(a,b,c){var e=a instanceof sigma.renderers.webgl,f=!1,g=[],i=document.createElement("canvas"),k=i.getContext("2d");return h.forEach(function(h){if(a.contexts[h]&&(b.labels!==!1||"labels"!==h)){var l=a.domElements[h]||a.domElements.scene,m=a.contexts[h];if(!~g.indexOf(m)){if(!f){var n,o;if(b.clip){var p=!b.size||b.size<1?window.innerWidth:b.size;n=l.width,o=l.height,c=d(n,o,p)}else n=j.width,o=j.height;if(i.width=c.width,i.height=c.height,!e&&!m instanceof WebGLRenderingContext){var q=s.settings("webglOversamplingRatio");i.width*=q,i.height*=q}f=!0,b.background&&(k.rect(0,0,i.width,i.height),k.fillStyle=b.background,k.fill())}k.drawImage(b.clip?l:j,0,0,i.width,i.height),g.push(m)}}}),g=[],i};var l=null;sigma.plugins.image=function(a,b,c){return sigma.plugins.killImage(),l||(l=new g(a,b,c)),l},sigma.plugins.killImage=function(){l instanceof g&&(l=null,j=null,k=null)}}).call(this);
//# sourceMappingURL=sigma.exporters.image.min.js.map