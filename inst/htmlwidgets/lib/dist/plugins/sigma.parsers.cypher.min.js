(function(a){"use strict";if("undefined"==typeof sigma)throw"sigma is not declared";sigma.utils.pkg("sigma.neo4j"),sigma.utils.pkg("sigma.utils"),sigma.utils.pkg("sigma.parsers"),sigma.neo4j.send=function(a,b,c,d,e,f){var g,h,i,j=sigma.utils.xhr(),f=f||-1;if(g=a,"object"==typeof a&&(g=a.url,h=a.user,i=a.password),!j)throw"XMLHttpRequest not supported, cannot load the file.";g+=b,j.open(c,g,!0),h&&i&&j.setRequestHeader("Authorization","Basic "+btoa(h+":"+i)),j.setRequestHeader("Accept","application/json"),j.setRequestHeader("Content-type","application/json; charset=utf-8"),f>0&&j.setRequestHeader("max-execution-time",f),j.onreadystatechange=function(){4===j.readyState&&e(JSON.parse(j.responseText))},j.send(d)},sigma.neo4j.cypher_parse=function(a){var b,c={nodes:[],edges:[]},d={},e={};Array.isArray(a)||(a=a.results[0].data),a.forEach(function(a){a.graph.nodes.forEach(function(a){var b={id:a.id,label:a.id,x:Math.random(),y:Math.random(),size:1,neo4j_labels:a.labels,neo4j_data:a.properties};b.id in d||(d[b.id]=b)}),a.graph.relationships.forEach(function(a){var b={id:a.id,label:a.type,source:a.startNode,target:a.endNode,neo4j_type:a.type,neo4j_data:a.properties};b.id in e||(e[b.id]=b)})});for(b in d)c.nodes.push(d[b]);for(b in e)c.edges.push(e[b]);return c},sigma.neo4j.cypher=function(a,b,c,d,e){var f,g,h="/db/data/transaction/commit",e=e||-1;f=JSON.stringify({statements:[{statement:b,resultDataContents:["graph"],includeStats:!1}]}),g=function(a){return function(b){if(b.errors.length>0)return a(null,b.errors);var d={nodes:[],edges:[]};d=sigma.neo4j.cypher_parse(b),c instanceof sigma?(c.graph.clear(),c.graph.read(d)):"object"==typeof c?(c=new sigma(c),c.graph.read(d),c.refresh()):"function"==typeof c&&(a=c,c=null),a&&a(c||d)}},sigma.neo4j.send(a,h,"POST",f,g(d),e)},sigma.neo4j.getLabels=function(a,b){sigma.neo4j.send(a,"/db/data/labels","GET",null,b)},sigma.neo4j.getTypes=function(a,b){sigma.neo4j.send(a,"/db/data/relationship/types","GET",null,b)}}).call(this);
//# sourceMappingURL=sigma.parsers.cypher.min.js.map