(function(a){"use strict";function b(a){var b=document.createEvent("MouseEvent");return b.initMouseEvent(a.type,a.canBubble,a.cancelable,a.view,a.detail,a.screenX,a.screenY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,a.relatedTarget),b}function c(a){return"undefined"!=typeof a.lat&&"undefined"!=typeof a.lng&&"number"==typeof a.lat&&"number"==typeof a.lng}function d(d,h,i){function j(b){if(C){for(var c,d=C.graph.nodes(),e=0;e<d.length;e++)c=d[e],A||c.leaflet_hidden===a||(c.hidden=c.leaflet_hidden,c.leaflet_hidden=a),c.leaflet_x!==a&&c.leaflet_y!==a&&(H?(c.x=c["read_cam0:x"]||c.x,c.y=c["read_cam0:y"]||c.y,c.leaflet_x_easing=c.leaflet_x,c.leaflet_y_easing=c.leaflet_y):(c.x=c.leaflet_x,c.y=c.leaflet_y),c.leaflet_x=a,c.leaflet_y=a);H?m(d,b):(C.refresh(),b&&b())}}function k(){A&&(A.has("geo-coordinates")?A.apply():A.nodesBy(c,"geo-coordinates").apply())}function l(){K=!K}function m(a,b){sigma.plugins.animate(C,{x:"leaflet_x_easing",y:"leaflet_y_easing"},{easing:I,onComplete:function(){C.refresh();for(var c=0;c<a.length;c++)a[c].leaflet_x_easing=null,a[c].leaflet_y_easing=null;b&&b()},duration:J})}function n(a){for(var b,c,d=a.data.nodes||[a.data.node],e=0,f=d.length;f>e;e++)b=d[e],c=B.utils.sigmaPointToLatLng(b),b.lat_init=b.lat,b.lng_init=b.lng,b.lat=c.lat,b.lng=c.lng}function o(){O||(O=!0,Object.keys(f).forEach(function(a){F[a]=C.settings(a),C.settings(a,f[a])}),C.camera.ratio=1)}function p(){O&&(O=!1,Object.keys(f).forEach(function(a){C.settings(a,F[a])}))}function q(){if(!P&&"undefined"!=typeof sigma.plugins.locate&&(P=!0,C)){var a=sigma.plugins.locate(C).settings.animation;G.nodeDuration=a.node.duration,G.edgeDuration=a.edge.duration,G.centerDuration=a.center.duration,a.node.duration=0,a.edge.duration=0,a.center.duration=0}}function r(){if(P&&"undefined"!=typeof sigma.plugins.locate&&(P=!1,C)){var a=sigma.plugins.locate(C).settings.animation;a.node.duration=G.nodeDuration,a.edge.duration=G.edgeDuration,a.center.duration=G.centerDuration}}function s(){g.forEach(function(a){E.container.addEventListener(a,u,!0)})}function t(){g.forEach(function(a){E.container.removeEventListener(a,u,!0)})}function u(a){D.getContainer().dispatchEvent(b(a))}function v(){C.settings("enableCamera",!1),E.container.style.visibility="hidden"}function w(){C.settings("enableCamera",!0),E.container.style.visibility="",B.syncNodes()}function x(){D&&(D.getContainer().style.opacity=0,D.getContainer().style.visibility="hidden")}function y(){D&&(D.getContainer().style.opacity=1,D.getContainer().style.visibility="")}if(sigma.classes.dispatcher.extend(this),"undefined"==typeof L)throw new Error("leaflet is not declared");i=i||{};var z,A,B=this,C=d,D=h,E=i.renderer||C.renderers[0],F=Object.create(null),G=Object.create(null),H=!1,I=i.easing,J=i.duration,K=!1,M=!1,N=!1,O=!1,P=!1,Q={x:C.camera.x,y:C.camera.y,ratio:C.camera.ratio};if(I&&(!sigma.plugins||"undefined"==typeof sigma.plugins.animate))throw new Error("sigma.plugins.animate is not declared");this.isApplicable=function(){for(var a=C.graph.nodes(),b=0,d=a.length;d>b;b++)if(c(a[b]))return!0;return!1},this.isEnabled=function(){return M},this.enable=function(){return y(),o(),q(),Q={x:C.camera.x,y:C.camera.y,ratio:C.camera.ratio},B.bindAll(),H=!!I,B.syncNodes(function(){B.dispatchEvent("enabled")}),H=!1,M=!0,B},this.disable=function(){return x(),p(),r(),H=!!I,A&&A.undo("geo-coordinates").apply(),j(function(){B.dispatchEvent("disabled")}),H=!1,M=!1,B.unbindAll(),B},this.syncNodes=function(b,d){var f,g,h;f="string"==typeof b||"number"==typeof b||Array.isArray(b)?C.graph.nodes(b):C.graph.nodes(),"function"==typeof b&&(d=b),Array.isArray(f)||(f=[f]);for(var i=0,j=f.length;j>i;i++)g=f[i],g.leaflet_x===a&&(g.leaflet_x=g.x),g.leaflet_y===a&&(g.leaflet_y=g.y),c(g)?(e.set(g.id,C.graph.nodes(g.id)),h=B.utils.latLngToSigmaPoint(g),H?(g.x=g["read_cam0:x"]||g.x,g.y=g["read_cam0:y"]||g.y,g.leaflet_x_easing=h.x,g.leaflet_y_easing=h.y):(g.x=h.x,g.y=h.y)):(e["delete"](g.id),A||(g.leaflet_hidden===a&&(g.leaflet_hidden=!!g.hidden),g.hidden=!0));return k(),H?m(f,d):(C.refresh(),d&&d()),B},this.syncMap=function(){if(Q.ratio!==C.camera.ratio)Q.ratio<C.camera.ratio?D.zoomIn():D.zoomOut(),C.camera.ratio=1;else{var a=C.camera.x-Q.x,b=C.camera.y-Q.y;Q.x=C.camera.x,Q.y=C.camera.y,D.panBy([a,b],{animate:!1})}return B},this.fitBounds=function(a){function b(){if(c.edgeIds){Array.isArray(c.edgeIds)||(c.edgeIds=[c.edgeIds]),c.nodeIds=[];for(var a=C.graph.edges(c.edgeIds),e=0,f=a.length;f>e;e++)c.nodeIds.push(a[e].source),c.nodeIds.push(a[e].target)}c.nodeIds&&!Array.isArray(c.nodeIds)&&(c.nodeIds=[c.nodeIds]);var g=c.nodeIds?C.graph.nodes(c.nodeIds):C.graph.nodes();D.fitBounds(B.utils.geoBoundaries(g),{animate:!1}),D.getZoom()===d?(H=!!c.animate,c.onComplete?B.syncNodes(c.onComplete):B.syncNodes(),H=!1):c.onComplete&&c.onComplete(),setTimeout(function(){C.unbind("animate.end",b)},0)}var c=a||{},d=D.getZoom();return K?C.bind("animate.end",b):b(),B},this.zoomIn=function(){D.zoomIn()},this.zoomOut=function(){D.zoomOut()},this.bindDragListener=function(a){return z=z||a,z.bind("drop",n),B},this.unbindDragListener=function(){return z!==a?(z.unbind("drop",n),z=a,B):void 0},this.bindFilter=function(a){return A=a,k(),B},this.unbindFilter=function(){return A=a,B},this.resetDraggedNodesLatLng=function(){for(var b,c=C.graph.nodes(),d=0,e=c.length;e>d;d++)b=c[d],b.lat_init!==a&&b.lng_init!==a&&(b.lat=b.lat_init,b.lng=b.lng_init,b.lat_init=a,b.lng_init=a);return B},this.bindAll=function(){return N?void 0:(N=!0,s(),C.bind("coordinatesUpdated",B.syncMap),D.on("zoomstart",v).on("zoomend",w),C.bind("animate.start",l),C.bind("animate.end",l),B)},this.unbindAll=function(){return N?(N=!1,t(),C.unbind("coordinatesUpdated",B.syncMap),D.off("zoomstart",v).off("zoomend",w),C.unbind("animate.start",l),C.unbind("animate.end",l),B.unbindDragListener(),B.unbindFilter(),B):void 0},this.kill=function(){B.unbindAll(),x(),p(),M=!1,C=a,E=a,D=a,Q=a},this.utils={},this.utils.sigmaPointToLatLng=function(a){var b=D.project(D.getCenter());return D.unproject([a.x+b.x-C.camera.x,a.y+b.y-C.camera.y])},this.utils.latLngToSigmaPoint=function(a){var b=D.project(D.getCenter()),c=D.project(a);return{x:c.x-b.x+C.camera.x,y:c.y-b.y+C.camera.y}},this.utils.geoBoundaries=function(a){for(var b,d=1/0,e=1/0,f=-(1/0),g=-(1/0),h=0,i=a.length;i>h;h++)b=a[h],!b.hidden&&c(b)&&(f=Math.max(b.lat,f),d=Math.min(b.lat,d),g=Math.max(b.lng,g),e=Math.min(b.lng,e));return L.latLngBounds(L.latLng(d,e),L.latLng(f,g))}}if("undefined"==typeof sigma)throw new Error("sigma is not declared");"undefined"==typeof L&&console.warn("Include leaflet to use the leaflet plugin for sigma."),sigma.utils.pkg("sigma.plugins.leaflet");var e=new sigma.utils.map;sigma.classes.graph.attach("addNode","sigma.plugins.leaflet.addNode",function(a){c(a)&&e.set(a.id,this.nodesIndex.get(a.id))}),sigma.classes.graph.attachBefore("dropNode","sigma.plugins.leaflet.dropNode",function(a){e["delete"](a)}),sigma.classes.graph.attachBefore("clear","sigma.plugins.leaflet.clear",function(){e.clear(),e=new sigma.utils.map}),sigma.classes.graph.hasMethod("hasLatLngCoordinates")||sigma.classes.graph.addMethod("hasLatLngCoordinates",function(b){if(b!==a){var d=this.nodesIndex.get(b);if(d)return c(d)}return 0!=e.size});var f={zoomingRatio:.999999999,doubleClickZoomingRatio:.999999999,mouseZoomDuration:0,doubleClickZoomDuration:0,autoRescale:["nodeSize","edgeSize"],zoomOnLocation:!1,mouseInertiaDuration:0,mouseInertiaRatio:1,touchInertiaDuration:0,touchInertiaRatio:1},g=["click","mouseup","mouseover","mouseout","mousemove","focus","blur"],h={};sigma.plugins.leaflet=function(b,c,e){if(!b)throw new Error('Missing argument: "sigInst"');if(!c)throw new Error('Missing argument: "leafletMap"');return h[b.id]||(h[b.id]=new d(b,c,e),b.bind("kill",function(){h[b.id].kill(),h[b.id]=a})),h[b.id]},sigma.plugins.killLeafletPlugin=function(b){if(!b)throw new Error('Missing argument: "sigInst"');h[b.id]instanceof d&&(h[b.id].kill(),h[b.id]=a)}}).call(this);
//# sourceMappingURL=sigma.plugins.leaflet.min.js.map