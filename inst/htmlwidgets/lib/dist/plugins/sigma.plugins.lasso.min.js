(function(a){"use strict";function b(b,c,d){if(sigma.classes.dispatcher.extend(this),sigma.renderers.webgl&&c instanceof sigma.renderers.webgl)throw new Error("The sigma.plugins.lasso is not compatible with the WebGL renderer");this.sigmaInstance=b,this.renderer=c,this.drawingCanvas=a,this.drawingContext=a,this.drewPoints=[],this.selectedNodes=[],this.isActive=!1,this.isDrawing=!1,f=document.body,this.settings=new sigma.classes.configurable({strokeStyle:"black",lineWidth:2,fillWhileDrawing:!1,fillStyle:"rgba(200, 200, 200, 0.25)",cursor:"crosshair"},d||{})}function c(a){var b=this.drawingCanvas.getBoundingClientRect();this.isActive&&(this.isDrawing=!0,this.drewPoints=[],this.selectedNodes=[],this.sigmaInstance.refresh(),this.drewPoints.push({x:a.clientX-b.left,y:a.clientY-b.top}),this.drawingCanvas.style.cursor=this.settings("cursor"),a.stopPropagation())}function d(a){if(this.isActive&&this.isDrawing){var b=0,c=0,d=this.drawingCanvas.getBoundingClientRect();switch(a.type){case"touchmove":b=a.touches[0].clientX,c=a.touches[0].clientY;break;default:b=a.clientX,c=a.clientY}this.drewPoints.push({x:b-d.left,y:c-d.top}),this.drawingContext.lineWidth=this.settings("lineWidth"),this.drawingContext.strokeStyle=this.settings("strokeStyle"),this.drawingContext.fillStyle=this.settings("fillStyle"),this.drawingContext.lineJoin="round",this.drawingContext.lineCap="round",this.drawingContext.clearRect(0,0,this.drawingContext.canvas.width,this.drawingContext.canvas.height);var e=this.drewPoints[0],f=this.drewPoints[1],g=this.drewPoints.length,h=function(a,b){return{x:a.x+(b.x-a.x)/2,y:a.y+(b.y-a.y)/2}};this.drawingContext.beginPath(),this.drawingContext.moveTo(e.x,e.y);for(var i=1;g>i;i++){var j=h(e,f);this.drawingContext.quadraticCurveTo(e.x,e.y,j.x,j.y),e=this.drewPoints[i],f=this.drewPoints[i+1]}this.drawingContext.lineTo(e.x,e.y),this.drawingContext.stroke(),this.settings("fillWhileDrawing")&&this.drawingContext.fill(),a.stopPropagation()}}function e(a){if(this.isActive&&this.isDrawing){this.isDrawing=!1;for(var b=this.renderer.nodesOnScreen,c=b.length,d=this.renderer.options.prefix||"";c--;){var e=b[c],f=e[d+"x"],g=e[d+"y"];this.drawingContext.isPointInPath(f,g)&&!e.hidden&&this.selectedNodes.push(e)}this.dispatchEvent("selectedNodes",this.selectedNodes),this.drawingContext.clearRect(0,0,this.drawingCanvas.width,this.drawingCanvas.height),this.drawingCanvas.style.cursor=this.settings("cursor"),a.stopPropagation()}}if("undefined"==typeof sigma)throw"sigma is not declared";sigma.utils.pkg("sigma.plugins");var f=a,g={};b.prototype.clear=function(){return this.deactivate(),this.sigmaInstance=a,this.renderer=a,this},b.prototype.activate=function(){return this.sigmaInstance&&!this.isActive&&(this.isActive=!0,this.renderer.domElements.lasso||(this.renderer.initDOM("canvas","lasso"),this.drawingCanvas=this.renderer.domElements.lasso,this.drawingCanvas.width=this.renderer.container.offsetWidth,this.drawingCanvas.height=this.renderer.container.offsetHeight,this.renderer.container.appendChild(this.drawingCanvas),this.drawingContext=this.drawingCanvas.getContext("2d"),this.drawingCanvas.style.cursor=this.settings("cursor")),h.apply(this)),this},b.prototype.deactivate=function(){return this.sigmaInstance&&this.isActive&&(this.isActive=!1,this.isDrawing=!1,i.apply(this),this.renderer.domElements.lasso&&(this.renderer.container.removeChild(this.renderer.domElements.lasso),delete this.renderer.domElements.lasso,this.drawingCanvas.style.cursor="",this.drawingCanvas=a,this.drawingContext=a,this.drewPoints=[])),this};var h=function(){this.drawingCanvas.addEventListener("mousedown",c.bind(this)),f.addEventListener("mousemove",d.bind(this)),f.addEventListener("mouseup",e.bind(this)),this.drawingCanvas.addEventListener("touchstart",c.bind(this)),f.addEventListener("touchmove",d.bind(this)),f.addEventListener("touchcancel",e.bind(this)),f.addEventListener("touchleave",e.bind(this)),f.addEventListener("touchend",e.bind(this))},i=function(){this.drawingCanvas.removeEventListener("mousedown",c.bind(this)),f.removeEventListener("mousemove",d.bind(this)),f.removeEventListener("mouseup",e.bind(this)),this.drawingCanvas.removeEventListener("touchstart",c.bind(this)),this.drawingCanvas.removeEventListener("touchmove",d.bind(this)),f.removeEventListener("touchcancel",e.bind(this)),f.removeEventListener("touchleave",e.bind(this)),f.removeEventListener("touchend",e.bind(this))};b.prototype.getSelectedNodes=function(){return this.selectedNodes},sigma.plugins.lasso=function(a,c,d){return g[a.id]||(g[a.id]=new b(a,c,d)),a.bind("kill",function(){g[a.id]instanceof b&&(g[a.id].clear(),delete g[a.id])}),g[a.id]}}).call(this);
//# sourceMappingURL=sigma.plugins.lasso.min.js.map