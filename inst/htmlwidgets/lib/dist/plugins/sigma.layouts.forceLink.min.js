(function(undefined){"use strict";function Supervisor(t,e){_root.URL=_root.URL||_root.webkitURL,e=e||{},this.sigInst=t,this.graph=this.sigInst.graph,this.ppn=10,this.ppe=3,this.config={},this.worker=null,this.shouldUseWorker=null,this.workerUrl=null,this.runOnBackground=null,this.easing=null,this.randomize=null,this.configure(e),this.started=!1,this.running=!1,this.initWorker()}if("undefined"==typeof sigma)throw new Error("sigma is not declared");sigma.utils.pkg("sigma.layouts");var _root=this,webWorkers="Worker"in _root,eventEmitter={};sigma.classes.dispatcher.extend(eventEmitter),Supervisor.prototype.makeBlob=function(t){var e;try{e=new Blob([t],{type:"application/javascript"})}catch(r){_root.BlobBuilder=_root.BlobBuilder||_root.WebKitBlobBuilder||_root.MozBlobBuilder,e=new BlobBuilder,e.append(t),e=e.getBlob()}return e},Supervisor.prototype.graphToByteArrays=function(){var t,e,r,s=this.graph.nodes(),n=this.graph.edges(),i=s.length*this.ppn,o=n.length*this.ppe,a={};for(this.nodesByteArray=new Float32Array(i),this.edgesByteArray=new Float32Array(o),t=e=0,r=s.length;r>t;t++)a[s[t].id]=e,this.nodesByteArray[e]=this.randomize(s[t].x),this.nodesByteArray[e+1]=this.randomize(s[t].y),this.nodesByteArray[e+2]=0,this.nodesByteArray[e+3]=0,this.nodesByteArray[e+4]=0,this.nodesByteArray[e+5]=0,this.nodesByteArray[e+6]=1+this.graph.degree(s[t].id),this.nodesByteArray[e+7]=1,this.nodesByteArray[e+8]=s[t].size,this.nodesByteArray[e+9]=s[t].fixed||0,e+=this.ppn;for(t=e=0,r=n.length;r>t;t++)this.edgesByteArray[e]=a[n[t].source],this.edgesByteArray[e+1]=a[n[t].target],this.edgesByteArray[e+2]=n[t].weight||0,e+=this.ppe},Supervisor.prototype.applyLayoutChanges=function(t){for(var e=this.graph.nodes(),r=0,s=0,n=this.nodesByteArray.length;n>s;s+=this.ppn)e[r].fixed||(t?(e[r].fa2_x=this.nodesByteArray[s],e[r].fa2_y=this.nodesByteArray[s+1]):(e[r].x=this.nodesByteArray[s],e[r].y=this.nodesByteArray[s+1])),r++},Supervisor.prototype.sendByteArrayToWorker=function(t){var e={action:t||"loop",nodes:this.nodesByteArray.buffer},r=[this.nodesByteArray.buffer];"start"===t&&(e.config=this.config||{},e.edges=this.edgesByteArray.buffer,r.push(this.edgesByteArray.buffer)),this.shouldUseWorker?this.worker.postMessage(e,r):_root.postMessage(e,"*")},Supervisor.prototype.start=function(){this.running||(this.running=!0,this.started?this.sendByteArrayToWorker():(this.sendByteArrayToWorker("start"),this.started=!0,eventEmitter.dispatchEvent("start")))},Supervisor.prototype.stop=function(){this.running&&(this.running=!1,eventEmitter.dispatchEvent("stop"))},Supervisor.prototype.initWorker=function(){var _this=this,workerFn=sigma.layouts.getForceLinkWorker();if(this.shouldUseWorker){if(this.workerUrl)this.worker=new Worker(this.workerUrl);else{var blob=this.makeBlob(workerFn);this.worker=new Worker(URL.createObjectURL(blob))}this.worker.postMessage=this.worker.webkitPostMessage||this.worker.postMessage}else eval(workerFn);this.msgName=this.worker?"message":"newCoords",this.listener=function(t){_this.nodesByteArray=new Float32Array(t.data.nodes),_this.running&&(_this.applyLayoutChanges(_this.runOnBackground),_this.sendByteArrayToWorker(),_this.runOnBackground||_this.sigInst.refresh({skipIndexation:!0})),t.data.converged&&(_this.running=!1),_this.running||(_this.killWorker(),_this.runOnBackground&&_this.easing?(_this.applyLayoutChanges(!0),eventEmitter.dispatchEvent("interpolate"),_this.graph.nodes().filter(function(t){return t.fixed}).forEach(function(t){t.fa2_x=t.x,t.fa2_y=t.y}),sigma.plugins.animate(_this.sigInst,{x:"fa2_x",y:"fa2_y"},{easing:_this.easing,onComplete:function(){_this.sigInst.refresh(),eventEmitter.dispatchEvent("stop")}})):(_this.applyLayoutChanges(!1),_this.sigInst.refresh(),eventEmitter.dispatchEvent("stop")))},(this.worker||document).addEventListener(this.msgName,this.listener),this.graphToByteArrays(),_this.sigInst.bind("kill",function(){sigma.layouts.killForceLink()})},Supervisor.prototype.killWorker=function(){this.worker?this.worker.terminate():(_root.postMessage({action:"kill"},"*"),document.removeEventListener(this.msgName,this.listener))},Supervisor.prototype.configure=function(t){switch(this.config=t,this.shouldUseWorker=t.worker===!1?!1:webWorkers,this.workerUrl=t.workerUrl,this.runOnBackground=t.background?!0:!1,this.easing=t.easing,t.randomize){case"globally":this.randomize=function(e){return Math.random()*(t.randomizeFactor||1)};break;case"locally":this.randomize=function(e){return e+Math.random()*(t.randomizeFactor||1)};break;default:this.randomize=function(t){return t}}if(this.started){var e={action:"config",config:this.config};this.shouldUseWorker?this.worker.postMessage(e):_root.postMessage(e,"*")}};var supervisor=null;sigma.layouts.startForceLink=function(t,e){return supervisor?supervisor.running||(supervisor.killWorker(),supervisor.initWorker(),supervisor.started=!1):supervisor=new Supervisor(t,e),e&&supervisor.configure(e),supervisor.start(),eventEmitter},sigma.layouts.stopForceLink=function(){return supervisor?(supervisor.stop(),supervisor):void 0},sigma.layouts.killForceLink=function(){supervisor&&(supervisor.stop(),supervisor.killWorker(),supervisor=null,eventEmitter={},sigma.classes.dispatcher.extend(eventEmitter))},sigma.layouts.configForceLink=function(t,e){return supervisor?supervisor.running||(supervisor.killWorker(),supervisor.initWorker(),supervisor.started=!1):supervisor=new Supervisor(t,e),supervisor.configure(e),eventEmitter},sigma.layouts.isForceLinkRunning=function(){return!!supervisor&&supervisor.running}}).call(this),function(undefined){"use strict";function no_crush(t){var e,r,s,n=["x","y","dx","dy","old_dx","old_dy","mass","convergence","size","fixed"],i=["source","target","weight"],o=["node","centerX","centerY","size","nextSibling","firstChild","mass","massCenterX","massCenterY"];for(r=0,s=o.length;s>r;r++)e=new RegExp("rp\\(([^,]*), '"+o[r]+"'\\)","g"),t=t.replace(e,0===r?"$1":"$1 + "+r);for(r=0,s=n.length;s>r;r++)e=new RegExp("np\\(([^,]*), '"+n[r]+"'\\)","g"),t=t.replace(e,0===r?"$1":"$1 + "+r);for(r=0,s=i.length;s>r;r++)e=new RegExp("ep\\(([^,]*), '"+i[r]+"'\\)","g"),t=t.replace(e,0===r?"$1":"$1 + "+r);return t}function getWorkerFn(){var t=crush?crush(Worker.toString()):Worker.toString();return";("+t+").call(this);"}if("undefined"==typeof sigma)throw new Error("sigma is not declared");sigma.utils.pkg("sigma.layouts");var _root=this,inWebWorker=!("document"in _root),Worker=function(t){function e(){var t,e,r={},s=arguments.length;for(t=s-1;t>=0;t--)for(e in arguments[t])r[e]=arguments[t][e];return r}function r(t){var e;for(e in t)"hasOwnProperty"in t&&!t.hasOwnProperty(e)||delete t[e];return t}function s(t,e,r,s){return Math.sqrt((r-t)*(r-t)+(s-e)*(s-e))}function n(t,e,r,s,n){return(n-s)*(t-e)/(r-e)+s}function i(t){return Math.acos(t.x/Math.sqrt(t.x*t.x+t.y*t.y))}function o(t,e,r,s){return{xi:-(s-e),yi:r-t,xi_prime:s-e,yi_prime:-(r-t)}}function a(t,e){return{x:(t.xi_prime-t.xi)/e,y:(t.yi_prime-t.yi)/e}}function h(t,e,r,s,n){return{x:t+(r-t)*n,y:e+(s-e)*n}}function g(t,e,r){r=r||{};l=t,c=e,v.nodesLength=l.length,v.edgesLength=c.length,u(r)}function u(t){v.settings=e(t,v.settings)}function p(){var t,e,r,g,u,p,d,y,k,m,b,w,M,B,_,A,x,L=v.settings.minNodeDistance;for(r=0;r<v.nodesLength;r+=v.ppn)l[r+4]=l[r+2],l[r+5]=l[r+3],l[r+2]=0,l[r+3]=0;if(v.settings.outboundAttractionDistribution){for(k=0,r=0;r<v.nodesLength;r+=v.ppn)k+=l[r+6];k/=v.nodesLength}if(v.settings.barnesHutOptimize){var S,W,E=1/0,F=-(1/0),I=1/0,z=-(1/0);for(f=[],r=0;r<v.nodesLength;r+=v.ppn)E=Math.min(E,l[r]),F=Math.max(F,l[r]),I=Math.min(I,l[r+1]),z=Math.max(z,l[r+1]);for(f[0]=-1,f[1]=(E+F)/2,f[2]=(I+z)/2,f[3]=Math.max(F-E,z-I),f[4]=-1,f[5]=-1,f[6]=0,f[7]=0,f[8]=0,t=1,r=0;r<v.nodesLength;r+=v.ppn)for(e=0;;)if(f[e+5]>=0)S=l[r]<f[e+1]?l[r+1]<f[e+2]?f[e+5]:f[e+5]+v.ppr:l[r+1]<f[e+2]?f[e+5]+2*v.ppr:f[e+5]+3*v.ppr,f[e+7]=(f[e+7]*f[e+6]+l[r]*l[r+6])/(f[e+6]+l[r+6]),f[e+8]=(f[e+8]*f[e+6]+l[r+1]*l[r+6])/(f[e+6]+l[r+6]),f[e+6]+=l[r+6],e=S;else{if(f[e]<0){f[e]=r;break}if(f[e+5]=t*v.ppr,d=f[e+3]/2,y=f[e+5],f[y]=-1,f[y+1]=f[e+1]-d,f[y+2]=f[e+2]-d,f[y+3]=d,f[y+4]=y+v.ppr,f[y+5]=-1,f[y+6]=0,f[y+7]=0,f[y+8]=0,y+=v.ppr,f[y]=-1,f[y+1]=f[e+1]-d,f[y+2]=f[e+2]+d,f[y+3]=d,f[y+4]=y+v.ppr,f[y+5]=-1,f[y+6]=0,f[y+7]=0,f[y+8]=0,y+=v.ppr,f[y]=-1,f[y+1]=f[e+1]+d,f[y+2]=f[e+2]-d,f[y+3]=d,f[y+4]=y+v.ppr,f[y+5]=-1,f[y+6]=0,f[y+7]=0,f[y+8]=0,y+=v.ppr,f[y]=-1,f[y+1]=f[e+1]+d,f[y+2]=f[e+2]+d,f[y+3]=d,f[y+4]=f[e+4],f[y+5]=-1,f[y+6]=0,f[y+7]=0,f[y+8]=0,t+=4,S=l[f[e]]<f[e+1]?l[f[e]+1]<f[e+2]?f[e+5]:f[e+5]+v.ppr:l[f[e]+1]<f[e+2]?f[e+5]+2*v.ppr:f[e+5]+3*v.ppr,f[e+6]=l[f[e]+6],f[e+7]=l[f[e]],f[e+8]=l[f[e]+1],f[S]=f[e],f[e]=-1,W=l[r]<f[e+1]?l[r+1]<f[e+2]?f[e+5]:f[e+5]+v.ppr:l[r+1]<f[e+2]?f[e+5]+2*v.ppr:f[e+5]+3*v.ppr,S!==W){f[W]=r;break}e=S}}if(v.settings.barnesHutOptimize)for(m=v.settings.scalingRatio,r=0;r<v.nodesLength;r+=v.ppn)for(e=0;;)if(f[e+5]>=0){if(A=Math.sqrt((l[r]-f[e+7])*(l[r]-f[e+7])+(l[r+1]-f[e+8])*(l[r+1]-f[e+8])),2*f[e+3]/A<v.settings.barnesHutTheta){if(b=l[r]-f[e+7],w=l[r+1]-f[e+8],v.settings.adjustSizes?A>0?(x=m*l[r+6]*f[e+6]/A/A,l[r+2]+=b*x,l[r+3]+=w*x):0>A&&(x=-m*l[r+6]*f[e+6]/A,l[r+2]+=b*x,l[r+3]+=w*x):A>0&&(x=m*l[r+6]*f[e+6]/A/A,l[r+2]+=b*x,l[r+3]+=w*x),f[e+4]<0)break;e=f[e+4];continue}e=f[e+5]}else{if(f[e]>=0&&f[e]!==r&&(b=l[r]-l[f[e]],w=l[r+1]-l[f[e]+1],A=Math.sqrt(b*b+w*w),v.settings.adjustSizes?A>0?(x=m*l[r+6]*l[f[e]+6]/A/A,l[r+2]+=b*x,l[r+3]+=w*x):0>A&&(x=-m*l[r+6]*l[f[e]+6]/A,l[r+2]+=b*x,l[r+3]+=w*x):A>0&&(x=m*l[r+6]*l[f[e]+6]/A/A,l[r+2]+=b*x,l[r+3]+=w*x)),f[e+4]<0)break;e=f[e+4]}else for(m=v.settings.scalingRatio,g=0;g<v.nodesLength;g+=v.ppn)for(u=0;g>u;u+=v.ppn)b=l[g]-l[u],w=l[g+1]-l[u+1],v.settings.adjustSizes?(A=Math.sqrt(b*b+w*w)-l[g+8]-l[u+8],A>0?(x=m*l[g+6]*l[u+6]/A/A,l[g+2]+=b*x,l[g+3]+=w*x,l[u+2]+=b*x,l[u+3]+=w*x):0>A&&(x=100*m*l[g+6]*l[u+6],l[g+2]+=b*x,l[g+3]+=w*x,l[u+2]-=b*x,l[u+3]-=w*x)):(A=Math.sqrt(b*b+w*w),A>0&&(x=m*l[g+6]*l[u+6]/A/A,l[g+2]+=b*x,l[g+3]+=w*x,l[u+2]-=b*x,l[u+3]-=w*x));for(y=v.settings.gravity/v.settings.scalingRatio,m=v.settings.scalingRatio,r=0;r<v.nodesLength;r+=v.ppn)x=0,b=l[r],w=l[r+1],A=Math.sqrt(b*b+w*w),v.settings.strongGravityMode?A>0&&(x=m*l[r+6]*y):A>0&&(x=m*l[r+6]*y/A),l[r+2]-=b*x,l[r+3]-=w*x;for(m=1*(v.settings.outboundAttractionDistribution?k:1),p=0;p<v.edgesLength;p+=v.ppe)g=c[p],u=c[p+1],d=c[p+2],_=Math.pow(d,v.settings.edgeWeightInfluence),b=l[g]-l[u],w=l[g+1]-l[u+1],v.settings.adjustSizes?(A=Math.sqrt(b*b+w*w-l[g+8]-l[u+8])-L,v.settings.linLogMode?v.settings.outboundAttractionDistribution?A>0&&(x=-m*_*Math.log(1+A)/A/l[g+6]):A>0&&(x=-m*_*Math.log(1+A)/A):v.settings.outboundAttractionDistribution?A>0&&(x=-m*_/l[g+6]):A>0&&(x=-m*_)):(A=Math.sqrt(b*b+w*w)-L,v.settings.linLogMode?v.settings.outboundAttractionDistribution?A>0&&(x=-m*_*Math.log(1+A)/A/l[g+6]):A>0&&(x=-m*_*Math.log(1+A)/A):v.settings.outboundAttractionDistribution?(A=1,x=-m*_/l[g+6]):(A=1,x=-m*_)),A>0&&(l[g+2]+=b*x,l[g+3]+=w*x,l[u+2]-=b*x,l[u+3]-=w*x);var q,O,D,R,U=0;if(v.settings.adjustSizes)for(r=0;r<v.nodesLength;r+=v.ppn)l[r+9]||(q=Math.sqrt(l[r+2]*l[r+2]+l[r+3]*l[r+3]),q>v.maxForce&&(l[r+2]=l[r+2]*v.maxForce/q,l[r+3]=l[r+3]*v.maxForce/q),O=l[r+6]*Math.sqrt((l[r+4]-l[r+2])*(l[r+4]-l[r+2])+(l[r+5]-l[r+3])*(l[r+5]-l[r+3])),D=Math.sqrt((l[r+4]+l[r+2])*(l[r+4]+l[r+2])+(l[r+5]+l[r+3])*(l[r+5]+l[r+3]))/2,R=.1*Math.log(1+D)/(1+Math.sqrt(O)),M=l[r],B=l[r+1],l[r]=l[r]+l[r+2]*(R/v.settings.slowDown),l[r+1]=l[r+1]+l[r+3]*(R/v.settings.slowDown),b=l[r],w=l[r+1],A=Math.sqrt((b-M)*(b-M)+(w-B)*(w-B)),U+=A);else for(r=0;r<v.nodesLength;r+=v.ppn)l[r+9]||(O=l[r+6]*Math.sqrt((l[r+4]-l[r+2])*(l[r+4]-l[r+2])+(l[r+5]-l[r+3])*(l[r+5]-l[r+3])),D=Math.sqrt((l[r+4]+l[r+2])*(l[r+4]+l[r+2])+(l[r+5]+l[r+3])*(l[r+5]+l[r+3]))/2,R=l[r+7]*Math.log(1+D)/(1+Math.sqrt(O)),l[r+7]=Math.min(1,Math.sqrt(R*(l[r+2]*l[r+2]+l[r+3]*l[r+3])/(1+Math.sqrt(O)))),M=l[r],B=l[r+1],l[r]=l[r]+l[r+2]*(R/v.settings.slowDown),l[r+1]=l[r+1]+l[r+3]*(R/v.settings.slowDown),b=l[r],w=l[r+1],A=Math.sqrt((b-M)*(b-M)+(w-B)*(w-B)),U+=A);if(v.iterations++,v.settings.autoStop&&(v.converged=v.iterations>v.settings.maxIterations||U/v.nodesLength<v.settings.avgDistanceThreshold,v.converged&&v.settings.alignNodeSiblings)){var j,P,C={},T={};for(p=0;p<v.edgesLength;p+=v.ppe)g=c[p],u=c[p+1],g!==u&&(C[g]=C[g]||{},C[u]=C[u]||{},C[g][u]=!0,C[u][g]=!0);Object.keys(C).forEach(function(t){t=~~t,P=Object.keys(C[t]),2==P.length&&(j=P[0]+";"+P[1],j in T?T[j].push(t):(j=P[1]+";"+P[0],T[j]||(T[j]=[~~P[1],~~P[0]]),T[j].push(t)))});var N,$,H,G,X,Y,K,J,Q,V,Z,tt,et,rt,st,nt=v.settings.nodeSiblingsAngleMin;Object.keys(T).forEach(function(t){if($=T[t].shift(),H=T[t].shift(),N=T[t].filter(function(t){return!l[t+9]}),1!=N.length){if(Y=l[$],K=l[$+1],J=l[H],Q=l[H+1],G=Object.keys(C[$]).length,X=Object.keys(C[H]).length,V=n(G/(G+X),0,1,.25,.75),tt=h(Y,K,J,Q,V),et=o(Y,K,J,Q),Z=s(Y,K,J,Q),rt=a(et,Z),st=i(rt),2*nt>Math.PI)throw new Error("ForceLink.Worker - Invalid parameter: angleMin must be smaller than 2 PI.");nt>0&&(nt>st||st>Math.PI-nt&&st<=Math.PI?rt={x:2*Math.cos(Math.PI-nt),y:2*Math.sin(Math.PI-nt)}:(st>2*Math.PI-nt||st>=Math.PI&&st<Math.PI+nt)&&(rt={x:2*Math.cos(nt),y:2*Math.sin(nt)}));var e=0,r=1,g=1;N.length%2==1&&(g=0,e=1);for(var u=0;u<N.length;u++)l[N[u]]=tt.x+r*rt.x*g*(e||u>=2?v.settings.nodeSiblingsScale:2*v.settings.nodeSiblingsScale/3),l[N[u]+1]=tt.y+r*rt.y*g*(e||u>=2?v.settings.nodeSiblingsScale:2*v.settings.nodeSiblingsScale/3),r=-r,g+=(u+e)%2}})}}function d(t){for(var e=0;t>e;e++)p();y()}var l,c,f,y,v={ppn:10,ppe:3,ppr:9,maxForce:10,iterations:0,converged:!1,settings:{linLogMode:!1,outboundAttractionDistribution:!1,adjustSizes:!1,edgeWeightInfluence:0,scalingRatio:1,strongGravityMode:!1,gravity:1,slowDown:1,barnesHutOptimize:!1,barnesHutTheta:.5,startingIterations:1,iterationsPerRender:1,maxIterations:1e3,avgDistanceThreshold:.01,autoStop:!1,alignNodeSiblings:!1,nodeSiblingsScale:1,nodeSiblingsAngleMin:0,minNodeDistance:0}};y="undefined"!=typeof window&&window.document?function(){if(!v.autoStop||v.converged){var t;document.createEvent?(t=document.createEvent("Event"),t.initEvent("newCoords",!0,!1)):(t=document.createEventObject(),t.eventType="newCoords"),t.eventName="newCoords",t.data={nodes:l.buffer,converged:v.converged},requestAnimationFrame(function(){document.dispatchEvent(t)})}}:function(){(!v.autoStop||v.converged)&&self.postMessage({nodes:l.buffer,converged:v.converged},[l.buffer])};var k=function(t){switch(t.data.action){case"start":g(new Float32Array(t.data.nodes),new Float32Array(t.data.edges),t.data.config),d(v.settings.startingIterations);break;case"loop":l=new Float32Array(t.data.nodes),d(v.settings.iterationsPerRender);break;case"config":u(t.data.config);break;case"kill":r(v),l=null,c=null,f=null,self.removeEventListener("message",k)}};self.addEventListener("message",k)},crush=null;if(inWebWorker)eval(getWorkerFn());else{if("undefined"==typeof sigma)throw new Error("sigma is not declared");sigma.layouts.getForceLinkWorker=getWorkerFn}}.call(this);