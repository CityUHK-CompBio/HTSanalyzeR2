(function(){"use strict";function a(a,b,c){function d(a){var b=window.getComputedStyle(a),c=function(a){return parseInt(b.getPropertyValue(a).replace("px",""))||0};return{left:a.getBoundingClientRect().left+c("padding-left"),top:a.getBoundingClientRect().top+c("padding-top")}}function e(a){u=!1,n.removeEventListener("mousemove",j),n.removeEventListener("mouseup",i),t?setTimeout(function(){r=t,p.addEventListener("mousedown",h)},0):r=null}function f(a){if(0!=a.data.enter.nodes.length){var b=a.data.enter.nodes[0];t&&t.id===b.id||(t=b,u||(r=t,p.addEventListener("mousedown",h)))}}function g(a){if(0!=a.data.leave.nodes.length){var b=a.data.leave.nodes[0];t&&t.id===b.id?(t=null,r=null):t||p.removeEventListener("mousedown",h)}}function h(a){y&&3!=a.which&&(u=!0,r&&l.graph.nodes().length>0&&(x=!0,p.removeEventListener("mousedown",h),n.addEventListener("mousemove",j),n.addEventListener("mouseup",i),o.settings({mouseEnabled:!1,enableHovering:!1}),k.dispatchEvent("startdrag",{node:r,captor:a,renderer:o})))}function i(a){if(u=!1,p.addEventListener("mousedown",h),n.removeEventListener("mousemove",j),n.removeEventListener("mouseup",i),o.settings({mouseEnabled:!0,enableHovering:!0}),w){if(k.dispatchEvent("drop",{node:s,captor:a,renderer:o}),m)for(var b=m.nodes(),c=0;c<b.length;c++)b[c].alphaX=void 0,b[c].alphaY=void 0;l.refresh()}k.dispatchEvent("dragend",{node:r,captor:a,renderer:o}),w=!1,s=null}function j(a){function b(){var b,c,e,f,g,h,i,j=d(o.container),n=a.clientX-j.left,p=a.clientY-j.top,t=Math.cos(o.camera.angle),u=Math.sin(o.camera.angle),v=l.graph.nodes(),z=[];if((!m||m.nbNodes()!==v.length)&&y&&!(v.length<2)&&(i=sigma.utils.getDistance(n,p,r[q+"x"],r[q+"y"]),!(x&&i<r[q+"size"]))){x=!1;for(var A=0;y&&(f=v[A],f&&(g={x:f.x*t+f.y*u,y:f.y*t-f.x*u,renX:f[q+"x"],renY:f[q+"y"]},z.push(g)),A!=v.length-1);A++)if(A>0){if(z[0].x!=z[1].x&&z[0].y!=z[1].y)break;z.pop()}var B=z[0],C=z[1],D=C.renX-B.renX;0===D&&(D=1);var E=C.renY-B.renY;if(0===E&&(E=1),n=(n-B.renX)/D*(C.x-B.x)+B.x,p=(p-B.renY)/E*(C.y-B.y)+B.y,b=n*t-p*u,c=p*t+n*u,m&&(e=m.nodes(),h=-1<e.map(function(a){return a.id}).indexOf(r.id)))for(var A=0;A<e.length;A++)s!=r&&(e[A].alphaX=void 0,e[A].alphaY=void 0),e[A].alphaX&&e[A].alphaY||(e[A].alphaX=e[A].x-n,e[A].alphaY=e[A].y-p),e[A].x=r.x+e[A].alphaX,e[A].y=r.y+e[A].alphaY;r.x=b,r.y=c,l.refresh({skipIndexation:!0}),w=!0,s=r,k.dispatchEvent("drag",{node:s,captor:a,renderer:o})}}if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1){clearTimeout(c);var c=setTimeout(b,0)}else b()}if(sigma.classes.dispatcher.extend(this),sigma.renderers.webgl&&b instanceof sigma.renderers.webgl)throw new Error("The sigma.plugins.dragNodes is not compatible with the WebGL renderer");var k=this,l=a,m=c,n=document.body,o=b,p=b.container.getElementsByClassName("sigma-mouse")[0],q=b.options.prefix,r=null,s=null,t=null,u=!1,v=!1,w=!1,x=!0,y=!0;b instanceof sigma.renderers.svg&&(p=b.container.firstChild),b.bind("hovers",f),b.bind("hovers",g),b.bind("click",e),this.enable=function(){y=!0},this.disable=function(){y=!1,r=null,s=null,t=null,u=!1,v=!1,w=!1,x=!0},this.unbindAll=function(){p.removeEventListener("mousedown",h),n.removeEventListener("mousemove",j),n.removeEventListener("mouseup",i),o.unbind("hovers",f),o.unbind("hovers",g)}}if("undefined"==typeof sigma)throw"sigma is not declared";sigma.utils.pkg("sigma.plugins");var b={};sigma.plugins.dragNodes=function(c,d,e){return b[c.id]||(b[c.id]=new a(c,d,e)),c.bind("kill",function(){sigma.plugins.killDragNodes(c)}),c.bind("animate.start",function(){b[c.id].disable()}),c.bind("animate.end",function(){b[c.id].enable()}),b[c.id]},sigma.plugins.killDragNodes=function(c){b[c.id]instanceof a&&(b[c.id].unbindAll(),delete b[c.id])}}).call(window);
//# sourceMappingURL=sigma.plugins.dragNodes.min.js.map